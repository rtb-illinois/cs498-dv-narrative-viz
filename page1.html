<!doctype html>
<html>
  <script src='https://d3js.org/d3.v5.min.js'></script>
  <head>
    <title>My Site</title>
  </head>
  <body>
    <h1>Page 1</h1>
    <p>Hello, page 1</p>

    <svg width=300 height=300>
    </svg>
    <script>
        d3.csv('./data/president.csv').then(function(csv_data) {
            var data = d3.nest()
                .key(function(d) { return d.party; })
                .key(function(d) { return d.year; })
                .rollup(function(v) { return 100.0 * d3.sum(v, function(d) {return d.candidatevotes}) / d3.sum(v, function(d) {return d.totalvotes;})})
                .entries(csv_data);
            var dem_data = data.filter(d=>d.key=="democrat");
            var rep_data = data.filter(d=>d.key=="republican");
            console.log(JSON.stringify(rep_data));
            var xAxis = d3.scaleTime().domain([new Date("1976-01-01"), new Date("2020-01-01")]).range([0, 200]);
            xAxis.tickFormat(d3.timeFormat("%Y"));
            d3.select("svg")
              .append("g")
                .attr("transform", "translate(50, 250)")
              .call(d3.axisBottom(xAxis));
            var yAxis = d3.scaleLinear().domain([0, 100]).range([200, 0]);
            d3.select("svg")
              .append("g")
                .attr("transform", "translate(50, 50)")
              .call(d3.axisLeft(yAxis));
            const line = d3.line().x(function(d) { return xAxis(new Date(d.key)); }).y(function(d) { return yAxis(d.value); });
            d3.select("svg")
              .selectAll("lines")
              .data(data)
              .enter()
              .append("g").attr("transform", "translate(50,50)")
              .append("path")
              .attr("fill", "none")
              .attr("stroke", function(d) {if (d.key == "democrat") { return "blue"; } else { return "red";} })
              .attr("stroke-width", 1.5)
              .attr("d", function(d) { return line(d.values); });
        }).catch(function(error) {
            console.log("Caught an error");
        });
    </script>
  </body>
</html>
